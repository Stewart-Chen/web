<!doctype html>
<html lang="zh-Hant" data-guard="checking">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>課程管理｜HeartHub Studio 心聚坊</title>

  <!-- 若 styles.css 已載入字型，可刪掉下一行 Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&display=swap" rel="stylesheet">
  <link rel="icon" href="../img/logo.png" sizes="16x16" type="image/png">
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="../css/admin.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&family=Noto+Serif+TC:wght@600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="../js/shared-layout.js"></script>
  <script defer src="../js/admin_js/admin-guard.js"></script>
  <script defer src="../js/admin_js/admin.js"></script>
</head>
<body>
  <main class="container page-admin">
    <section class="admin-wrap">
      
      <!-- 左欄：課程管理 -->
      <div class="admin-col">
        <div class="admin-card is-collapsible is-collapsed" id="courses-card">
          <header class="admin-header collapsible-trigger" role="button" aria-expanded="false" tabindex="0">
            <h3 style="margin:0;">課程管理</h3>
            <span class="caret"></span>
          </header>
      
          <div class="collapsible-body is-collapsed" id="courses-body" aria-hidden="true">
            <div class="admin-tools" style="display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px;">
              <label class="muted" for="admin-teacher-filter" style="display:flex; align-items:center; gap:6px;">
                <select id="admin-teacher-filter">
                  <option value="">全部老師</option>
                  <option value="fanfan">汎汎</option>
                  <option value="xd">小D</option>
                </select>
              </label>
              <button type="button" class="btn" id="admin-refresh" style="display: none;">重新整理</button>
            </div>
      
            <div id="admin-courses" style="margin-top:10px;">
              <!-- 由 admin.js 產生清單 -->
            </div>
          </div>
        </div>
      </div>

      <!-- 右欄：課程內容 + 單元 -->
      <div class="admin-col">
        <div class="admin-card">
          <h3 style="margin:0;">課程內容</h3>
          <form id="admin-course-form" class="form-grid" style="margin-top:12px;">
            <input type="hidden" id="ac-id" />
            <label>標題 <input id="ac-title" required /></label>
            <label>摘要 <input id="ac-summary" /></label>
            <label>描述 <textarea id="ac-desc" rows="4"></textarea></label>
            
            <section class="card is-collapsible is-collapsed" id="gallery-card">
              <header class="admin-header collapsible-trigger" role="button" aria-expanded="false" tabindex="0">
                <h4 style="margin:0;">課程圖片</h4>
                <span class="caret"></span>
              </header>
            
              <div class="collapsible-body is-collapsed" id="gallery-body" aria-hidden="true">
                <p class="muted" style="margin:4px 0 10px;">可一次選多張。</p>
                <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                  <input id="ac-gallery-files" type="file" accept="image/*" multiple style="position:absolute;left:-9999px;">
                  <button id="ac-select-files" type="button" class="btn">選擇圖片</button>
                  <button id="ac-upload-btn" type="button" class="btn">上傳</button>
                </div>
            
                <div id="ac-gallery" class="grid" style="margin-top:10px; grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); gap:10px;">
                  <!-- 動態縮圖 -->
                </div>
              </div>
            </section>

            <label>授課老師
              <select id="ac-teacher" required>
                <option value="">— 選擇 —</option>
                <option value="fanfan">汎汎（園藝）</option>
                <option value="xd">小D（藝術）</option>
              </select>
            </label>
            <label>分類
              <select id="ac-category" required>
                <option value="">— 選擇 —</option>
                <option value="horti">園藝</option>
                <option value="art">藝術</option>
              </select>
            </label>
            
            <label>課程人數（上限）
              <input id="ac-people" type="number" min="1" placeholder="例如 12" />
            </label>
            
            <label>課程時數（小時）
              <input id="ac-duration" type="number" step="0.5" min="0" placeholder="例如 2.5" />
            </label>
            
            <div class="form-row-2">
              <label>設備項目－主辦單位提供（以逗號分隔）
                <input id="ac-equip-org" type="text" placeholder="例如：投影機, 麥克風" />
              </label>
              <label>設備項目－講師自備（以逗號分隔）
                <input id="ac-equip-teacher" type="text" placeholder="例如：筆電, 小鏟子" />
              </label>
            </div>

            <label>材料項目（以逗號分隔）
              <input id="ac-materials" type="text" placeholder="例如：彩鹽, 玻璃瓶, 漏斗" />
            </label>
            
            <label>材料費（NTD）
              <input id="ac-material-fee" type="number" step="1" min="0" placeholder="例如 300" />
            </label>
            
            <label>課程費用（NTD）
              <input id="ac-course-fee" type="number" step="1" min="0" placeholder="例如 2000" />
            </label>
            
            <label style="display:none;">優先順序（越大越前）
              <input id="ac-sort" type="number" step="1" placeholder="預設 0" />
            </label>
            
            <label>方案類型
              <input id="ac-plan-type" type="text" placeholder="例如：workshop / 課程 / 體驗" />
            </label>
            
            <label>課程關鍵字（以逗號分隔）
              <input id="ac-keywords" type="text" placeholder="例如：正念, 初學者, 手作" />
            </label>

            <label><input type="checkbox" id="ac-published" /> 已發佈</label>
            <div class="actions" style="display:flex;gap:8px;">
              <button type="submit" class="btn primary">儲存</button>
              <button type="button" id="admin-soft-delete" class="btn secondary" style="display:none;">移到回收（軟刪除）</button>
              <button type="button" class="btn primary" id="admin-new-course">新頁面</button>
              <button type="button" id="admin-hard-delete" class="btn danger">刪除</button>
            </div>
          </form>
        </div>
          
          <!-- 單元：可收折 -->
          <div class="admin-card" id="lessons-wrapper">
            <header class="admin-header collapsible-trigger" role="button" aria-expanded="false" tabindex="0">
              <h3 style="margin:0;">單元</h3>
              <span class="caret" aria-hidden="true"></span>
            </header>
        
            <div class="collapsible-body is-collapsed" id="lessons-body" aria-hidden="true">
              <div id="admin-lessons" style="margin-top:10px;">
                <!-- 由 admin.js 產生單元清單 -->
              </div>
        
              <form id="admin-lesson-form" class="form-grid" style="margin-top:12px;">
                <input type="hidden" id="al-id" />
                <label>順序 <input type="number" id="al-order" min="1" value="1" required /></label>
                <label>標題 <input id="al-title" required /></label>
                <label>內容 <textarea id="al-content" rows="3"></textarea></label>
                <div class="actions" style="display:flex;gap:8px;flex-wrap:wrap;">
                  <button type="submit" class="btn">新增 / 更新單元</button>
                  <button type="button" id="admin-lesson-delete" class="btn danger">刪除選取單元</button>
                </div>
              </form>
        
              <p class="muted" style="margin-top:8px;">＊只有被加入管理者清單的帳號才能操作。</p>
            </div>
          </div>
        
      </div>
    </section>
  </main>
</body>
</html>
