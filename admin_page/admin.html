<!doctype html>
<html lang="zh-Hant" data-guard="checking">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>課程管理｜HeartHub Studio 心聚坊</title>

  <!-- 若 styles.css 已載入字型，可刪掉下一行 Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&display=swap" rel="stylesheet">
  <link rel="icon" href="../img/logo.png" sizes="16x16" type="image/png">
  <link rel="stylesheet" href="../css/styles.css" />
  <link rel="stylesheet" href="../css/admin.css" />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&family=Noto+Serif+TC:wght@600;700;800&display=swap" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="../js/shared-layout.js"></script>
  <script defer src="../js/admin_js/admin-guard.js"></script>
  <script defer src="../js/admin_js/admin.js"></script>
</head>
<body>
  <main class="container page-admin">
    <section class="admin-wrap">
      <!-- 左欄：課程管理 -->
      <div class="admin-col">
        <div class="admin-card">
          <header class="admin-header">
            <h3 style="margin:0;">課程管理</h3>
            <div class="admin-tools">
              <button type="button" class="btn" id="admin-refresh">重新整理</button>
              <button type="button" class="btn primary" id="admin-new-course">＋ 新增課程</button>
            </div>
          </header>
          <div id="admin-courses" style="margin-top:10px;">
            <!-- 由 admin.js 產生清單 -->
          </div>
        </div>
      </div>
      <!-- 右欄：課程內容 + 單元 -->
      <div class="admin-col">
        <div class="admin-card">
          <h3 style="margin:0;">課程內容</h3>
          <form id="admin-course-form" class="form-grid" style="margin-top:12px;">
            <input type="hidden" id="ac-id" />
            <label>標題 <input id="ac-title" required /></label>
            <label>摘要 <input id="ac-summary" /></label>
            <label>描述 <textarea id="ac-desc" rows="4"></textarea></label>
            
            <!-- 圖片上傳到 gallery（取代原 ac-cover 輸入） -->
            <section class="card" style="margin-top:12px;">
              <h4 style="margin:0 0 8px;">課程圖片（Gallery）</h4>
              <p class="muted" style="margin:4px 0 10px;">
                可一次選多張。
              </p>
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <input id="ac-gallery-files" type="file" accept="image/*" multiple style="position:absolute;left:-9999px;">
                <button id="ac-select-files" type="button" class="btn">選擇圖片</button>
                <button id="ac-upload-btn" type="button" class="btn">上傳</button>
              </div>
            
              <div id="ac-gallery" class="grid" style="margin-top:10px; grid-template-columns: repeat(auto-fill, minmax(120px,1fr)); gap:10px;">
                <!-- 這裡會由 admin.js 動態插入縮圖 -->
              </div>
            </section>

            <label>授課老師
              <select id="ac-teacher" required>
                <option value="">— 選擇 —</option>
                <option value="fanfan">汎汎（園藝）</option>
                <option value="xd">小D（藝術）</option>
              </select>
            </label>
            <label><input type="checkbox" id="ac-published" /> 已發佈（公開可見）</label>
            <div class="actions" style="display:flex;gap:8px;flex-wrap:wrap;">
              <button type="submit" class="btn primary">儲存</button>
              <button type="button" id="admin-soft-delete" class="btn secondary">移到回收（軟刪除）</button>
              <button type="button" id="admin-hard-delete" class="btn danger">永久刪除</button>
            </div>
          </form>
        </div>
        <div class="admin-card" style="margin-top:16px;">
          <h3 style="margin:0;">單元（Lessons）</h3>
          <div id="admin-lessons" style="margin-top:10px;">
            <!-- 由 admin.js 產生單元清單 -->
          </div>
          <form id="admin-lesson-form" class="form-grid" style="margin-top:12px;">
            <input type="hidden" id="al-id" />
            <label>順序 <input type="number" id="al-order" min="1" value="1" required /></label>
            <label>標題 <input id="al-title" required /></label>
            <label>內容 <textarea id="al-content" rows="3"></textarea></label>
            <div class="actions" style="display:flex;gap:8px;flex-wrap:wrap;">
              <button type="submit" class="btn">新增 / 更新單元</button>
              <button type="button" id="admin-lesson-delete" class="btn danger">刪除選取單元</button>
            </div>
          </form>
          <p class="muted" style="margin-top:8px;">＊只有被加入管理者清單的帳號才能操作。</p>
        </div>
      </div>
    </section>
  </main>
</body>
</html>
