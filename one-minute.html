<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>心聚 1 分鐘｜HeartHub Studio 心聚坊</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- 站內樣式 / 字型 -->
  <link rel="icon" href="img/logo.png" sizes="16x16" type="image/png">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="css/one-minute.css">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600&display=swap" rel="stylesheet">

  <!-- SDK / 共用腳本：順序很重要！ -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script defer src="js/shared-layout.js"></script>
  <script defer src="js/shared-dialog.js"></script>
  <script defer src="js/app.js"></script>
  <!-- 本頁獨立腳本 -->
  <script defer src="js/one-minute.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>

</head>
<body>
  <main class="container flow-lg">
    <section class="page-hero">
      <div>
        <h1>心聚 1 分鐘</h1>
        <div class="muted">只要 60 秒，記錄你的狀態，累積成「心聚指標」報告。</div>
      </div>
    </section>

    <!-- A. 控制台 -->
    <section class="card flow-md" aria-labelledby="ctrl-title">
      <div class="legend"><h2 id="ctrl-title" style="margin:0;font-size:18px;">控制面板</h2></div>
      <div class="pill-group" role="group" aria-label="時間點">
        <button class="pill" data-tp="pre"  aria-pressed="true">課前</button>
        <button class="pill" data-tp="post" aria-pressed="false">課後</button>
        <button class="pill" data-tp="72h"  aria-pressed="false">72 小時追蹤</button>
      </div>

      <button id="btn-print" class="btn secondary" type="button" title="列印或存成 PDF">列印 / PDF</button>
      <button id="toggle-ids" class="btn" style="margin-top:10px;">顯示ID</button>
      
      <div id="id-section" class="ctrl-grid" style="margin-top:10px; display:none;">
        <label class="field">課程ID
          <input id="ctrl-course" class="input" type="number" inputmode="numeric" placeholder="例如 55">
        </label>
        <label class="field">場次ID
          <input id="ctrl-session" class="input" type="number" inputmode="numeric" placeholder="例如 101">
        </label>
      </div>
    </section>

    <!-- 進度條 -->
    <section class="card flow-sm" aria-live="polite">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <div><strong>完成度</strong> <span id="progress-text" class="muted">0 / 4</span></div>
        <button id="btn-fill-3" class="btn ok" type="button" title="一鍵填 3 分（都還好）">一鍵填 3 分</button>
      </div>
      <div class="progress"><span id="progress-bar" style="width:0%"></span></div>
    </section>

    <!-- B. 表單本體 -->
    <section class="card">
      <header class="flow-sm">
        <p class="muted" style="margin:0;">分數越高代表狀態越理想。請直覺選擇。</p>
      </header>

      <form id="one-minute-form" class="flow-md">
        <input type="hidden" name="timepoint" id="timepoint" value="pre">
        <input type="hidden" name="session_id" id="session_id">
        <input type="hidden" name="course_id"  id="course_id">

        <fieldset class="group">
          <div class="card">
            <div class="legend"><strong>1）穩定度</strong><span class="hint">1 不穩 → 5 很穩</span></div>
            <p class="exp muted">我是否感覺沉著、內心安定？</p>
            <div class="scale" role="radiogroup" aria-label="穩定度">
              <label><input type="radio" name="stability" value="1" required><span class="opt">1</span></label>
              <label><input type="radio" name="stability" value="2"><span class="opt">2</span></label>
              <label><input type="radio" name="stability" value="3"><span class="opt">3</span></label>
              <label><input type="radio" name="stability" value="4"><span class="opt">4</span></label>
              <label><input type="radio" name="stability" value="5"><span class="opt">5</span></label>
            </div>
          </div>

          <div class="card">
            <div class="legend"><strong>2）壓力復原</strong><span class="hint">1 幾乎無法復原 → 5 很快能復原</span></div>
            <p class="exp muted">遇到壓力時，我能多快恢復平穩？</p>
            <div class="scale" role="radiogroup" aria-label="壓力復原">
              <label><input type="radio" name="recovery" value="1" required><span class="opt">1</span></label>
              <label><input type="radio" name="recovery" value="2"><span class="opt">2</span></label>
              <label><input type="radio" name="recovery" value="3"><span class="opt">3</span></label>
              <label><input type="radio" name="recovery" value="4"><span class="opt">4</span></label>
              <label><input type="radio" name="recovery" value="5"><span class="opt">5</span></label>
            </div>
          </div>

          <div class="card">
            <div class="legend"><strong>3）社會連結</strong><span class="hint">1 很疏離 → 5 很連結</span></div>
            <p class="exp muted">我覺得自己和他人的互動是否順暢、有連結感？</p>
            <div class="scale" role="radiogroup" aria-label="社會連結">
              <label><input type="radio" name="connectedness" value="1" required><span class="opt">1</span></label>
              <label><input type="radio" name="connectedness" value="2"><span class="opt">2</span></label>
              <label><input type="radio" name="connectedness" value="3"><span class="opt">3</span></label>
              <label><input type="radio" name="connectedness" value="4"><span class="opt">4</span></label>
              <label><input type="radio" name="connectedness" value="5"><span class="opt">5</span></label>
            </div>
          </div>

          <div class="card">
            <div class="legend"><strong>4）專注力</strong><span class="hint">1 很難專心 → 5 很能專心</span></div>
            <p class="exp muted">我是否能把心思放在當下，專注於正在做的事？</p>
            <div class="scale" role="radiogroup" aria-label="專注力">
              <label><input type="radio" name="focus" value="1" required><span class="opt">1</span></label>
              <label><input type="radio" name="focus" value="2"><span class="opt">2</span></label>
              <label><input type="radio" name="focus" value="3"><span class="opt">3</span></label>
              <label><input type="radio" name="focus" value="4"><span class="opt">4</span></label>
              <label><input type="radio" name="focus" value="5"><span class="opt">5</span></label>
            </div>
          </div>
        </fieldset>

        <fieldset id="post-only-share" class="group">
          <div class="card">
            <div class="legend"><strong>5）你願意推薦這堂課嗎？</strong><span id="nps-hint" class="hint">0（完全不會）– 10（一定會）</span></div>
            <div class="nps-row" role="radiogroup" aria-label="NPS">
              <label><input type="radio" name="nps" value="0" required><span class="opt">0</span></label>
              <label><input type="radio" name="nps" value="1"><span class="opt">1</span></label>
              <label><input type="radio" name="nps" value="2"><span class="opt">2</span></label>
              <label><input type="radio" name="nps" value="3"><span class="opt">3</span></label>
              <label><input type="radio" name="nps" value="4"><span class="opt">4</span></label>
              <label><input type="radio" name="nps" value="5"><span class="opt">5</span></label>
              <label><input type="radio" name="nps" value="6"><span class="opt">6</span></label>
              <label><input type="radio" name="nps" value="7"><span class="opt">7</span></label>
              <label><input type="radio" name="nps" value="8"><span class="opt">8</span></label>
              <label><input type="radio" name="nps" value="9"><span class="opt">9</span></label>
              <label><input type="radio" name="nps" value="10"><span class="opt">10</span></label>
            </div>
          </div>
        </fieldset>

        <fieldset id="post-only-content" class="group">
          <div class="card">
            <div class="legend"><strong>6）今天最大的收穫</strong><span class="hint">60 字以內</span></div>
            <textarea name="one_line" rows="2" maxlength="60" class="input" placeholder="例：我學會用 3 分鐘呼吸讓自己安定"></textarea>
            <div class="count"><span id="one-line-count">0</span> / 60</div>
          </div>
        </fieldset>

        <fieldset id="post-only-actions" class="group">
          <div class="card">
            <div class="legend"><strong>7）接下來 72 小時你會做：</strong><span class="hint">可複選</span></div>
            <div class="toolbar">
              <label><input type="checkbox" name="next_actions" value="breathing_3m"> 3 分鐘呼吸</label>
              <label><input type="checkbox" name="next_actions" value="horticulture_5m"> 5 分鐘園藝照護</label>
              <label><input type="checkbox" name="next_actions" value="art_10m"> 10 分鐘藝術塗鴉</label>
              <label><input type="checkbox" name="next_actions" value="gratitude_colleague"> 和同事/家人互相感謝</label>
              <label>其他：<input type="text" name="next_actions_other" maxlength="40" class="input" style="width:220px;"></label>
            </div>
          </div>
        </fieldset>

        <fieldset id="post-only-scope" class="group">
          <div class="card">
            <div class="legend"><strong>8）你會把練習帶到：</strong><span class="hint">可複選</span></div>
            <div class="toolbar">
              <label><input type="checkbox" name="adoption_scope" value="self"> 個人</label>
              <label><input type="checkbox" name="adoption_scope" value="family"> 家人</label>
              <label><input type="checkbox" name="adoption_scope" value="coworkers"> 同事/同學</label>
              <label><input type="checkbox" name="adoption_scope" value="community"> 社團/社群</label>
            </div>
          </div>
        </fieldset>

        <fieldset id="h72-only" class="group">
          <div class="card">
            <div class="legend"><strong>7）這 72 小時你完成了哪些行動？</strong><span class="hint">可複選</span></div>
            <div class="toolbar">
              <label><input type="checkbox" name="actions_done" value="breathing_3m"> 3 分鐘呼吸</label>
              <label><input type="checkbox" name="actions_done" value="horticulture_5m"> 5 分鐘園藝照護</label>
              <label><input type="checkbox" name="actions_done" value="art_10m"> 10 分鐘藝術塗鴉</label>
              <label><input type="checkbox" name="actions_done" value="gratitude_colleague"> 和同事/家人互相感謝</label>
              <label>其他：<input type="text" name="actions_done_other" maxlength="40" class="input" style="width:220px;"></label>
            </div>
          </div>
        </fieldset>

        <!-- 表單訊息 / 成果顯示 -->
        <div id="form-msg" class="alert hidden" role="status" aria-live="polite"></div>
      </form>
    </section>
  </main>

  <!-- 底部浮動送出列（整合 返回 / 重填 / 送出） -->
  <div class="dock">
    <div class="dock-inner">
      <div>
        <strong>心聚 1 分鐘｜<span id="dock-tp">課前</span></strong>
        <div class="muted" id="dock-meta">課程：—　場次：—</div>
      </div>
      <div class="toolbar">
        <small id="dock-status">尚未填寫</small>
        <button id="dock-back"  class="btn">返回</button>
        <button id="dock-reset" class="btn secondary">重填</button>
        <button id="dock-submit" class="btn primary">送出</button>
      </div>
    </div>
  </div>
</body>
</html>
